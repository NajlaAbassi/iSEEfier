---
title: "iSEEfier"
author: "Najla Abassi"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
library("iSEE")
sce <- readRDS("~/Projects/NA04-kevin-scRNA-Tcells/Projekt_Kevin/sce_merged_corrected_without_doublets.RDS")

iSEE(sce)
```


just gonna type some thoughts...
let's get rid of the list of panels: i.e. the user doesn't choose how they want to visualize but rather give them a general view with different panels all at once; they decide what to keep

- decide what are the relevant panel:

+ reduced dim
+ rowdata tab (eventually we can put multiple tables that can feed them to plot 2 features against each other interactively)
+ feature assay plot
+ coldata plot (maybe when selected we feed it to the TSNE plots colored by expression?, not by default)
+ complex heatmap

i like the idea of having a panel that holds records of ur genes list --> but we gotta add another panel??? but i use iSEE and probably this wont't be my way to go

this function assumes that your gene list contains at least 2 genes; maybe fix this aspect so that even with 1 gene we can use it
we ll give the user to choice between TSNE and UMAP from the beginning, if they don't specify, it's pca, or maybe should we set it to tsne?

+ panel width, this one is basically for all panels, is it interesting to have it seperate for eaach panel? sera-t-il plus interessant d exprimer la largeur en fonction du nombre de genes? par exp un multiple de 3 , width = 4 so that we get in each row 1 gene

what about the order of panels?


```{r}
# this function creates the initial config for an iSEE instance to explore your marker gene list


iSEEfier <- function(feature.list, reddim.type=NULL, panel.width=4L) {
  initial <- list()
  feature.list <- as.list(feature.list)
  panel.width <- as.integer(panel.width)
  
  for (j in feature.list) {
    initial[[paste0("ReducedDimensionPlot", which(feature.list == j))]] <- new("ReducedDimensionPlot",
                                                                               Type = reddim.type,
                                                                               ColorBy = "Feature name",
                                                                               ColorByFeatureName = j,
                                                                               PanelWidth = panel.width)
    
    initial[[paste0("FeatureAssayPlot", which(feature.list == j))]] <- new("FeatureAssayPlot",
                                                                           XAxis = "Column data",
                                                                           XAxisColumnData = "clusters.mnn",
                                                                           YAxisFeatureName = j,
                                                                           PanelWidth = panel.width)
    
    initial[[paste0("RowDataTable1", which(feature.list == j))]] <- new("RowDataTable",
                                                                        Selected = j,
                                                                        Search = j,
                                                                        PanelWidth = panel.width)
  }
  
  
  initial[[paste0("FeatureAssayPlot", length(feature.list) + 1)]] <- new("FeatureAssayPlot", 
                                      XAxis = "Feature name", 
                                      XAxisFeatureName = feature.list[[1]],
                                      YAxisFeatureName = feature.list[[2]],
                                      PanelWidth = panel.width)
  
  
  initial[["ColumnDataPlot1"]] <- new("ColumnDataPlot",
                                      XAxis = "Column data",
                                      YAxis = "group",
                                      XAxisColumnData = "clusters.mnn",
                                      ColorBy = "Column data",
                                      ColorByColumnData = "clusters.mnn",
                                      PanelWidth = panel.width) 
  
  initial[[paste0("ReducedDimensionPlot", length(feature.list) + 1)]] <- new("ReducedDimensionPlot",
                                                                             Type = reddim.type,
                                                                             ColorByColumnData = "clusters.mnn",
                                                                            ColorBy = "Column data",
                                                                               ColumnSelectionSource = paste0("FeatureAssayPlot", length(feature.list) + 1),
                                                                               PanelWidth = panel.width)
  
  
  initial[["ComplexHeatmapPlot1"]] <- new("ComplexHeatmapPlot",
                                          CustomRowsText = paste(feature.list, collapse = "\n"),
                                          ColumnData = "clusters.mnn",
                                          PanelWidth = panel.width)
  
  
  
  
  return(initial)
  
}




# list of features
naive <- c("CD28", "CD27", "IL7R", "CCR7", "SELL", "PTPRC", "PRF1", "GZMB") # maybe if i use the sce with merged fb i can look at the exp of cd45RA and cd45RO separately
stem_memory <- c("CCR7", "SELL","PTPRC", "CD28", "CD27")
central_memory <- c("CCR7", "SELL", "CD28", "CD27", "EOMES", "PTPRC")
effector_memory <- c("CCR7", "TOX", "EOMES", "SELL", "PTPRC")
effector <- c("CCR7", "SELL", "PRF1", "GZMB", "EOMES", "PTPRC")
cd8_treg <- c("FOXP3","IL2RA","TGFB1") 
senescent <- c("CD28", "CD27", "B3GAT1", "KLRG1", "PTPRC", "TIGIT", "GZMB")
exhausted <- c("PDCD1", "CTLA4", "HAVCR2", "LAG3", "TOX", "TIGIT")
nk_t<- c("NCAM1")


my_reddim.type <- "TSNE"

# create initial with iSEEfier
initial <- iSEEfier(cd8_treg,my_reddim.type)

iSEE(sce, initial = initial)

```



```{r}


```



